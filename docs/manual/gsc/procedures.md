---
title: Procedures specific to the compiler
---

# Procedures specific to the compiler

The Gambit Scheme compiler features the following procedures that are not
available in the Gambit Scheme interpreter.

#### compile-file-to-target

```scheme
(compile-file-to-target file [options: options]
                             [output: output]
                             [expression: expression]) ;; procedure
```

The `file` parameter must be a string. If `expression` is not specified, `file` must
name an existing file containing Scheme source code. The extension can be
omitted from `file` when the Scheme file has a `.scm`, `.sld` or `.six` extension.
By default, this procedure compiles the source file into a file containing C
code. A different target language can be selected in the `options`. The generated
file is named after `file` with the extension replaced with `.c` or `.js`, as
appropriate for the `target` selected. The name of the generated file can also be
specified directly with the `output` parameter. If `output` is a string naming a
directory then the generated file is created in that directory. Otherwise the
name of the generated file is `output`.

Compilation options are specified through the `options` parameter which must be an
association list. Any combination of the following options can be used:
`target`, `verbose`, `report`, `expansion`, `gvm`, `debug`, `module-ref`, and
`linker-name`.

When `expression` is specified, the `file` parameter is not open or read. Instead,
`expression` is used as though it was the content of the file. This makes it
possible to compile source code without having to create a file to contain the
code. Note that `file` is used in error messages and to determine the output file
name if `output` is not specified.

When the compilation is successful, `compile-file-to-target` returns the name of
the file generated. When there is a compilation error, `#f` is returned.

```shell
$ cat h.scm
(display "hello") (newline)
$ gsc
Gambit v4.9.4

> (compile-file-to-target "h")
"/Users/feeley/gambit/doc/h.c"
```

#### compile-file

```scheme
(compile-file file [options: options]
                   [output: output]
                   [base: base]
                   [expression: expression]
                   [cc-options: cc-options]
                   [ld-options-prelude: ld-options-prelude]
                   [ld-options: ld-options]) ;; procedure
```

The `file`, `options`, `output`, and `expression` parameters have the same meaning as
for the `compile-file-to-target` procedure, except that `file` may be a Scheme
source file or a file possibly generated by the Gambit Scheme compiler (for
example with the `compile-file-to-target` procedure). The `cc-options` parameter is
a string containing the options to pass to the C compiler and the
`ld-options-prelude` and `ld-options` parameters are strings containing the options
to pass to the C linker (the options in `ld-options-prelude` are passed to the C
linker before the input file and the options in `ld-options` are passed after).

The `compile-file` procedure compiles the source file file into an object file,
which is either a file dynamically loadable using the load procedure, or a C
linkable object file destined to be linked with the C linker (for example to
create a standalone executable program). The presence of the `obj` option in
options will cause the creation of a C linkable object file and therefore the
options `ld-options-prelude` and `ld-options` are ignored, otherwise a dynamically
loadable file is created. In both cases, if file is a Scheme source file, the
compiler first compiles file to a C file which is created in the same directory
as `file` regardless of the `output` parameter. Then the C file is compiled with the
C compiler.

When the compilation is successful, `compile-file` returns the name of the object
file generated. When there is a compilation error, `#f` is returned.

The name of the object file can be specified with the `output` parameter. If
`output` is a string naming a directory then the object file is created in that
directory. Otherwise the name of the object file is `output`.

In the case of a dynamically loadable object file, by default the object file is
named after `file` with the extension replaced with `.on`, where `n` is a positive
integer that acts as a version number. The next available version number is
generated automatically by `compile-file`.

When dynamically loaded object files are loaded using the `load` procedure, the
`.on` extension can be specified (to select a particular version) or omitted (to
load the file with a `.on` extension with the highest `n` consecutively from `1`).
When the `.on` extension is not specified and older versions are no longer
needed, all versions must be deleted and the compilation must be repeated (this
is necessary because the file name, including the extension, is used to name
some of the exported symbols of the object file).

Note that dynamically loadable object files can only be generated on host
operating systems that support dynamic loading.

```shell
$ cat h.scm
(display "hello") (newline)
$ gsc
Gambit v4.9.4

> (compile-file "h")
"/Users/feeley/gambit/doc/h.o1"
> (load "h")
hello
"/Users/feeley/gambit/doc/h.o1"
> (compile-file-to-target "h" output: "h.o99.c")
"/Users/feeley/gambit/doc/h.o99.c"
> (compile-file "h.o99.c")
"/Users/feeley/gambit/doc/h.o99"
> (load "h.o99")
hello
"/Users/feeley/gambit/doc/h.o99"
> (compile-file-to-target "h")
"/Users/feeley/gambit/doc/h.c"
> (compile-file "h.c" options: '(obj))
"/Users/feeley/gambit/doc/h.o"
```

#### link-incremental

```scheme
(link-incremental module-list [output: output]
                              [linker-name: linker-name]
                              [base: base]
                              [warnings?: warnings?]) ;; procedure
```

The first parameter must be a non empty list of strings naming Scheme modules to
link (the file extension may be omitted). An incremental link file is generated
for the modules specified in `module-list`. By default the link file generated is
named `last_.ext`, where last is the name of the last module, without the file
extension, and `ext` is the appropriate extension for the target. The name of the
generated link file can be specified with the `output` parameter. If `output` is a
string naming a directory then the link file is created in that directory.
Otherwise the name of the link file is `output`.

The base link file is specified by the `base` parameter, which must be a string.
By default the base link file is the Gambit runtime library link file
`~~lib/_gambit` (with extension appropriate for the target). However, when `base`
is supplied it is the name of the base link file (the file extension may be
omitted).

The `warnings?` parameter controls whether warnings are generated for undefined
references.

The following example shows how to build the executable program `hello` which
contains the two Scheme modules `h.scm` and `w.six`.

```shell
$ uname -srmp
Darwin 8.1.0 Power Macintosh powerpc
$ cat h.scm
(display "hello") (newline)
$ cat w.six
display("world"); newline();
$ gsc
Gambit v4.9.4

> (compile-file-to-target "h")
"/Users/feeley/gambit/doc/h.c"
> (compile-file-to-target "w")
"/Users/feeley/gambit/doc/w.c"
> (link-incremental '("h" "w") output: "hello.c")
"/Users/feeley/gambit/doc/hello_.c"
> ,q
$ gsc -obj h.c w.c hello.c
h.c:
w.c:
hello.c:
$ gcc h.o w.o hello.o -lgambit -o hello
$ ./hello
hello
world
```

#### link-flat

```scheme
(link-flat module-list [output: output]
                       [linker-name: linker-name]
                       [warnings?: warnings?]) ;; procedure
```

The first parameter must be a non empty list of strings naming Scheme modules to
link (the file extension may be omitted). The first string must be the name of a
Scheme module or the name of a link file and the remaining strings must name
Scheme modules. A flat link file is generated for the modules specified in
`module-list`. By default the link file generated is named `last_.ext`, where `last`
is the name of the last module, without the file extension, and `ext` is the
appropriate extension for the target. The name of the generated link file can be
specified with the `output` parameter. If `output` is a string naming a directory
then the link file is created in that directory. Otherwise the name of the link
file is `output`. If a dynamically loadable object file is produced from the link
file `output`, then the name of the dynamically loadable object file must be
`output` stripped of its file extension.

The `warnings?` parameter controls whether warnings are generated for undefined
references.

The following example shows how to build the dynamically loadable object file
`lib.o1` which contains the two Scheme modules `m6.scm` and `m7.scm`.

```scheme
$ uname -srmp
Darwin 8.1.0 Power Macintosh powerpc
$ cat m6.scm
(define (f x) (g (* x x)))
$ cat m7.scm
(define (g y) (+ n y))
$ gsc
Gambit v4.9.4

> (compile-file-to-target "m6")
"/Users/feeley/gambit/doc/m6.c"
> (compile-file-to-target "m7")
"/Users/feeley/gambit/doc/m7.c"
> (link-flat '("m6" "m7") output: "lib.o1.c")
*** WARNING -- "*" is not defined,
***            referenced in: ("m6.c")
*** WARNING -- "+" is not defined,
***            referenced in: ("m7.c")
*** WARNING -- "n" is not defined,
***            referenced in: ("m7.c")
"/Users/feeley/gambit/doc/lib.o1.c"
> ,q
$ gcc -bundle -D___DYNAMIC m6.c m7.c lib.o1.c -o lib.o1
$ gsc
Gambit v4.9.4

> (load "lib")
*** WARNING -- Variable "n" used in module "m7" is undefined
"/Users/feeley/gambit/doc/lib.o1"
> (define n 10)
> (f 5)
35
> ,q
```

The `warnings` indicate that there are no definitions (`defines` or `set!`s) of the
variables `*`, `+` and `n` in the modules contained in the library. Before the library
is used, these variables will have to be bound; either implicitly (by the
runtime library) or explicitly.
